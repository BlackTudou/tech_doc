=====
i2c
=====

调试中遇到的问题
================

 .. note::
    调试仪器前期推荐使用示波器，可以看到电压变化

------------------------
SCL timeout 中断一直触发
------------------------

SCL timeout 中断： 是 SCL 低电平超时检测，接上示波器可以看到 i2c 初始化后(gpio配置为i2c的引脚功能)，电压从3.3V->1.2V

从设备是 camera(gc0328c)，不接从设备电压正常(3.3V)，接上camera后电压就被拉低了，肯定是从设备影响了它，解决办法：

 - 提高GPIO的负载能力， 将 gpio 的 capacity 设置为3
 - 检查板子的硬件，最终问题就是 **板子上有些跳线帽没插上**

----------------
SCL 波形呈三角形
----------------

外接上拉电阻到引脚：2K的上拉电阻

---------------
收不到从设备ACK
---------------

现象：i2c 总线上可以看到 从设备回了ACK(第9个clock，SDA为低电平)，但是中断里面没有读到(SMB_STAT的bit[8])

解决方法：将i2c对应的 ``clock_gate_bypass`` 打开，设置为 1，否则的话就需要读两遍(第一次是读不到的)